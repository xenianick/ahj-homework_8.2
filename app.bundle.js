!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1)}([function(e,t,n){},function(e,t,n){"use strict";n.r(t);n(0);function r(e,t,n=""){const r=document.createElement(e);return r.className=t,r.innerHTML=n,r}function o(e){return r("div","user-name-container",`<p>&#128064;</p><p>${e}</p>`)}async function i(e,t){const[n,r,i,a]=e,s=new Promise(e=>{r.addEventListener("submit",r=>{if(r.preventDefault(),i.checkValidity()){new Promise(e=>e(async function(e){const t=new FormData;return t.append("name",e),await fetch("https://ahj-homework-8-2.herokuapp.com",{method:"POST",body:t})}(i.value))).then(r=>{if(204===r.status){const r=o(i.value);t.appendChild(r),r.classList.add("current-user"),e(i.value),n.remove()}205===r.status&&i.after(a)})}})});return i.addEventListener("input",()=>{a.remove()}),s}function a(e,t,n){const o=r("div","message-card"),i=r("div","message-info",`<p>${e}, ${function(e){const t=new Date(e);function n(e){let t=e.toString();return 1===t.length&&(t=`0${t}`),t}const r=t.getFullYear();let o=t.getMonth()+1;o=n(o);let i=t.getDate();i=n(i);let a=t.getHours();a=n(a);let s=t.getMinutes();return s=n(s),`${a}:${s} ${i}.${o}.${r}`}(t)}</p>`),a=r("div","message-text",`<p>${n}</p>`);return o.appendChild(i),o.appendChild(a),o}function s(e,t,n,r){const o=a(e,t,n);return r.appendChild(o),r.scrollTop=r.scrollHeight,o}function c(e,t,n){const r=+new Date;return s(e,r,t,n).classList.add("current-user"),JSON.stringify({user:e,time:r,text:t})}const d=document.querySelector("body"),u=r("div","main-container"),p=function(){const e=r("div","widget-container"),t=r("div","current-users-container"),n=r("div","chat-container"),o=r("form","send-message-form"),i=r("textarea","message-input");i.required=!0,i.placeholder="Type your message";const a=r("button","message-send-btn","&#8682;");return o.appendChild(i),o.appendChild(a),e.appendChild(t),e.appendChild(n),e.appendChild(o),{container:e,elements:[t,n,o,i]}}(),l=p.container,[f,m]=p.elements;async function h(){const e=function(){const e=document.querySelector("body"),t=r("div","popup-container"),n=r("div","add-user-popup"),o=r("div","header","<p>Выберите псевдоним</p>"),i=r("form","form"),a=r("input","name-field");a.required=!0;const s=r("button","user-save-btn","Продолжить"),c=r("div","error","<p>Данное имя уже существует</p>");return i.appendChild(a),i.appendChild(s),n.appendChild(o),n.appendChild(i),t.appendChild(n),e.insertBefore(t,e.lastChild),[t,i,a,c]}(),t=await i(e,f);return await async function(e){const t=await fetch("https://ahj-homework-8-2.herokuapp.com");if(t.ok){(await t.json()).forEach(t=>{const n=JSON.parse(t),r=a(n.user,n.time,n.text);e.appendChild(r),e.scrollTop=e.scrollHeight})}}(m),t}u.appendChild(l),d.insertBefore(u,d.firstChild),async function(){!function(e,t){const[n,r,i,a]=t.elements,d=new WebSocket("wss://ahj-homework-8-2.herokuapp.com/wss");d.binaryType="blob",d.addEventListener("open",()=>{i.addEventListener("submit",t=>{if(t.preventDefault(),a.checkValidity()){const t=c(e,a.value,r);d.send(t),a.value=""}}),i.addEventListener("keydown",t=>{if(13===t.keyCode){if(t.preventDefault(),a.checkValidity()){const t=c(e,a.value,r);d.send(t),a.value=""}}})}),d.addEventListener("message",t=>{const i=JSON.parse(t.data);Object.prototype.hasOwnProperty.call(i,"user")?s(i.user,i.time,i.text,r):(n.innerHTML="",i.forEach(t=>{const r=o(t.name);t.name===e?(n.prepend(r),r.classList.add("current-user")):n.appendChild(r)}))}),d.addEventListener("close",e=>{console.log("connection closed",e)}),d.addEventListener("error",()=>{console.log("error")})}(await h(),p)}()}]);